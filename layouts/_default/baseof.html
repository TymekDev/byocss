<!DOCTYPE html>
<html lang="en">

<head>
  <title>{{ if or (ne .Kind "home") (ne .Title "") }}{{ .Title }} | {{ end }}{{ site.Title }}</title>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {{- with (resources.Get "main.scss") }}
    {{- $style := resources.ToCSS . | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $style.RelPermalink }}">
  {{- end }}
</head>

<body>
  {{ partial "navbar.html" . }}

  {{- block "header" . }}
    <header>
      {{- if .IsNode }}
        <a href="#entries">Skip to entries</a>
      {{- end }}
      <h1>{{ .Title }}</h1>

      {{- if or (not .IsNode) site.Params.showListDate }}
        {{ partial "entry_date.html" . }}
      {{- end }}
      {{ partial "tags.html" . }}
    </header>
  {{- end }}

  {{- block "main" . }}
    {{- with .Content}}
      <main>
        {{- . }}
      </main>
    {{- end }}
  {{- end }}

  {{- if .IsNode }}
    {{- if eq .Kind "taxonomy" }}
      <section id="terms">
        <ol>
          {{- $type := .Type }}
          {{/* FIXME: this should rely on uglyURLs option from config, but I couldn't access it. */}}
          {{- $format := cond (strings.HasSuffix .Permalink ".html") "%s/%s.html" "%s/%s/" }}
          {{- range .Data.Terms.Alphabetical }}
            <li><a href="{{ printf $format $type .Term | absURL }}">{{ .Term }}</a></li>
          {{- end }}
        </ol>
      </section>
    {{- else }}
      <section id="entries">
        {{- block "entries" . }}
          {{- $pages := union .RegularPages .Sections }}
          {{- if .IsHome }}
            {{- $pages = where site.RegularPages "Type" "in" site.Params.mainSections }}
          {{- end }}
          <ol>
            {{- range $pages }}
              <li>
                <article>
                  <a href="{{ .Permalink }}">
                    <h3>{{ .Title }}</h3>
                    {{ partial "entry_date.html" . }}
                    {{- with .Summary }}
                      <p>{{ . | plainify | safeHTML }}</p>
                    {{- end }}
                  </a>
                  {{ partial "tags.html" . }}
                </article>
              </li>
            {{- end }}
          </ol>
        {{- end }}
      </section>
    {{- end }}
  {{- end }}

  {{- partialCached "footer.html" . }}
</body>

</html>
